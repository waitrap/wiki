
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../%E3%83%84%E3%83%BC%E3%83%AB/git%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9/">
      
      
        <link rel="next" href="../../%E8%A8%80%E8%AA%9E/spring/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>ulTRON4.0仕様 - wain's wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="wain&#39;s wiki" class="md-header__button md-logo" aria-label="wain's wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            wain's wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ulTRON4.0仕様
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="wain&#39;s wiki" class="md-nav__button md-logo" aria-label="wain's wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    wain's wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to wain's wiki
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ツール
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            ツール
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E3%83%84%E3%83%BC%E3%83%AB/git%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gitの使い方
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    組み込み
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            組み込み
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ulTRON4.0仕様
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ulTRON4.0仕様
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      タスク管理機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="タスク管理機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      タスクの生成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      タスク付属同期機能
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      同期・通信機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="同期・通信機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      セマフォ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      イベントフラグ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      データキュー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      メールボックス
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      拡張同期・通信機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="拡張同期・通信機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      ミューテックス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      メッセージバッファ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      ランデブ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      メモリプール管理機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="メモリプール管理機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      固定長メモリプール
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      可変長メモリプール
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      割り込み管理機能
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      時間管理機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="時間管理機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      システム時刻管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      周期ハンドラ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      アラームハンドラ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      型の説明
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    言語
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            言語
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%A8%80%E8%AA%9E/spring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      タスク管理機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="タスク管理機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      タスクの生成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      タスク付属同期機能
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      同期・通信機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="同期・通信機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      セマフォ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      イベントフラグ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      データキュー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      メールボックス
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      拡張同期・通信機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="拡張同期・通信機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      ミューテックス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      メッセージバッファ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      ランデブ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      メモリプール管理機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="メモリプール管理機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      固定長メモリプール
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      可変長メモリプール
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      割り込み管理機能
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      時間管理機能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="時間管理機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      システム時刻管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      周期ハンドラ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      アラームハンドラ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      型の説明
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>ulTRON4.0仕様</h1>

<h2 id="_1">タスク管理機能</h2>
<p>タスクの状態は以下の図の通り:
<a class="glightbox" href="../../images/image3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="alt text" src="../../images/image3.png" style="display: block; margin: auto;" width="300px" /></a></p>
<p><strong>タスクの記述形式</strong></p>
<p><div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">タスク本体</span>
<span class="w">    </span><span class="n">ext_tsk</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<strong>タスク生成時に使う情報( T_CTSK Create Task Struct)</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_ctsk</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">tskatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// タスク属性</span>
<span class="w">    </span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">;</span><span class="w">　</span><span class="c1">// タスクの拡張情報</span>
<span class="w">    </span><span class="n">FP</span><span class="w"> </span><span class="n">task</span><span class="p">;</span><span class="w">　</span><span class="c1">// タスクの起動番地</span>
<span class="w">    </span><span class="n">PRI</span><span class="w"> </span><span class="n">itskpri</span><span class="p">;</span><span class="w">　</span><span class="c1">// タスクの起動時優先度</span>
<span class="w">    </span><span class="n">SIZE</span><span class="w"> </span><span class="n">stksz</span><span class="p">;</span><span class="w">　</span><span class="c1">// タスクのスタックサイズ</span>
<span class="w">    </span><span class="n">VP</span><span class="w"> </span><span class="n">stk</span><span class="p">;</span><span class="w">　</span><span class="c1">// タスクのスタック領域の先頭番地</span>
<span class="p">}</span><span class="w"> </span><span class="n">T_CTSK</span>
</code></pre></div>
<h3 id="_2">タスクの生成</h3>
<p><strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// タスクを生成する</span>
<span class="n">ER</span><span class="w">　</span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_tsk</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">tskid</span><span class="p">,</span><span class="n">T_CTSK</span><span class="w"> </span><span class="o">*</span><span class="n">pk_ctsk</span><span class="p">);</span>
</code></pre></div>
<strong>使い方の具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// 拡張情報を定義する</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">device_id</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span><span class="w"> </span><span class="n">TASK_PARAM</span><span class="p">;</span>
<span class="n">TASK_PARAM</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sensor&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="c1">// タスク本体を定義する</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">){</span>
<span class="w">    </span><span class="n">TASK_PARAM</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TASK_PARAM</span><span class="o">*</span><span class="p">)</span><span class="n">exinf</span><span class="p">;</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;device_id = %d, name = %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="n">ext_tsk</span><span class="p">();</span><span class="w">  </span><span class="c1">// タスク終了</span>
<span class="p">}</span>

<span class="c1">// 構造体T_CTSK構造する</span>
<span class="n">T_CTSK</span><span class="w"> </span><span class="n">ctsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">tskatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_HLNG</span><span class="p">,</span><span class="w"> </span><span class="c1">// 高級言語のインターフェースで処理単位を起動</span>
<span class="w">    </span><span class="n">exinf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">VP_INT</span><span class="p">)</span><span class="o">&amp;</span><span class="n">param</span><span class="p">,</span><span class="w"> </span><span class="c1">// 拡張情報</span>
<span class="w">    </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="c1">// タスク本体</span>
<span class="w">    </span><span class="n">itskpri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">stksz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span>
<span class="p">};</span>

<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_tsk</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctsk</span><span class="p">);</span><span class="w">  </span><span class="c1">// タスクID = 1で登録</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">act_tsk</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// タスクを起動（task関数が呼ばれる）</span>
<span class="p">}</span>
</code></pre></div>
<strong>要すると、<code>T_CTSK</code>を構造して、<code>cre_tsk</code>に渡す。</strong></p>
<h2 id="_3">タスク付属同期機能</h2>
<p>タスクの状態を<strong>直接的に</strong>操作することによって<strong>同期</strong>を行うための機能である。taskを定義する関数の中で直接使う</p>
<p><strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slp_tsk</span><span class="p">();</span><span class="w">　</span><span class="c1">// 起床待ち</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ecrd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wup_tsk</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">tskid</span><span class="p">);</span><span class="c1">//クラスの起床</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="c1">// TASKA tskid=1</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskA</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskA: 処理待機中…&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">slp_tsk</span><span class="p">();</span><span class="w">  </span><span class="c1">// ← 起床要求が来るまでスリープ（待機）</span>

<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskA: 起床 → 処理開始&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// センサーデータ処理など</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// TASKB</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskB</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dly_tsk</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1000ms 待つ</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskB: TaskA を起こす&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wup_tsk</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// TaskA(ID=1) を起こす</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">E_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskB: wup_tsk 失敗 ercd=%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ercd</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_4">同期・通信機能</h2>
<h3 id="_5">セマフォ</h3>
<p>使用されていない資源の有無や数量を数値で表現することにより、その資源を使用する際の排他制御や同期を行うためのオブジェクトである。</p>
<p><strong>セマフォ生成情報</strong>
<div class="highlight"><pre><span></span><code><span class="n">typedof</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_csem</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">sematr</span><span class="p">;</span><span class="w"> </span><span class="c1">// セマフォ属性</span>
<span class="w">    </span><span class="n">UINT</span><span class="w">　</span><span class="n">isemcnt</span><span class="p">;</span><span class="w"> </span><span class="c1">// セマフォの資源数の初期値</span>
<span class="w">    </span><span class="n">UINT</span><span class="w">　</span><span class="n">maxsem</span><span class="p">;</span><span class="w"> </span><span class="c1">// セマフォの最大資源数</span>
<span class="p">}</span><span class="w">　</span><span class="n">T_CSEM</span>
</code></pre></div>
<strong>セマフォ状態情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_rsem</span><span class="p">{</span>
<span class="w">    </span><span class="n">ID</span><span class="w"> </span><span class="n">wtskid</span><span class="p">;</span><span class="w"> </span><span class="c1">// 待ち行列のタスクのID番号</span>
<span class="w">    </span><span class="n">UINT</span><span class="w">　</span><span class="n">semcnt</span><span class="p">;</span><span class="w"> </span><span class="c1">// セマフォの現在の資源数</span>
<span class="p">}</span><span class="w"> </span><span class="n">T_RSEM</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_sem</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">semid</span><span class="p">,</span><span class="n">T_CSEM</span><span class="w"> </span><span class="o">*</span><span class="n">pk_csem</span><span class="p">);</span><span class="w"> </span><span class="c1">// セマフォの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sig_sem</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">semid</span><span class="p">);</span><span class="w"> </span><span class="c1">// セマフォ資源の返却  セマフォにプラス１</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wai_sem</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">semid</span><span class="p">);</span><span class="w"> </span><span class="c1">// セマフォ資源の獲得</span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// セマフォを作る</span>
<span class="n">T_CSEM</span><span class="w"> </span><span class="n">csem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">sematr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span>
<span class="w">    </span><span class="n">isemcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">maxsem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">};</span>
<span class="n">ER</span><span class="w">　</span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_sem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">csem</span><span class="p">);</span><span class="w"> </span><span class="c1">//セマフォID = 1 を作成</span>

<span class="c1">// task A</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskA</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskA: データ準備中…&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">dly_tsk</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1秒待つ（データ準備のつもり）</span>

<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskA: 準備完了 → セマフォ解放&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">sig_sem</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">     </span><span class="c1">// セマフォ + 1</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// task B</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskB</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskB: セマフォ待ち中…&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">wai_sem</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// セマフォID=1 を待つ（準備完了を待つ）セマフォ - 1</span>
<span class="w">                     </span><span class="c1">// セマフォ＝０なら、ずっと待つ</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskB: セマフォ取得 → 処理開始&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ここで TaskA の処理済みデータを使って何かをする</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_6">イベントフラグ</h3>
<p>イベントの有無をビット毎のフラグで表現することにより、同期を行うためのオブジェクトである。</p>
<p><strong>flag生成情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cflg</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w">　</span><span class="n">flgatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// イベントフラグ属性</span>
<span class="w">    </span><span class="n">FLGPTN</span><span class="w"> </span><span class="n">iflgptn</span><span class="p">;</span><span class="w">　</span><span class="c1">// イベントフラグのビットパターンの初期値</span>
<span class="p">}</span><span class="w"> </span><span class="n">T_CFLG</span><span class="p">;</span>
</code></pre></div>
<strong>flag状態情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_rflg</span><span class="p">{</span>
<span class="w">    </span><span class="n">ID</span><span class="w">　</span><span class="n">wtskid</span><span class="p">;</span><span class="w"> </span><span class="c1">// イベントフラグの待ち行列の先頭タスクID</span>
<span class="w">    </span><span class="n">FLGPTN</span><span class="w"> </span><span class="n">flgptn</span><span class="p">;</span><span class="w">　</span><span class="c1">// 現在のビッドパターン</span>
<span class="p">}</span><span class="w"> </span><span class="n">T_RFLG</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_flg</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">flgid</span><span class="p">,</span><span class="w"> </span><span class="n">T_CFLG</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cflg</span><span class="p">);</span>
<span class="c1">// イベントフラグ待ち</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wai_flg</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">flgid</span><span class="p">,</span><span class="n">FLGPTN</span><span class="w"> </span><span class="n">waiptn</span><span class="p">,</span><span class="n">MODE</span><span class="w"> </span><span class="n">wfmode</span><span class="p">,</span><span class="n">FLGPTN</span><span class="w"> </span><span class="o">*</span><span class="n">p_flgptn</span><span class="p">);</span><span class="w"> </span>
<span class="c1">// イベントフラグのセット</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_flg</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">flgid</span><span class="p">,</span><span class="n">FLGPTN</span><span class="w"> </span><span class="n">setptn</span><span class="p">);</span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// イベントフラグ生成</span>
<span class="n">T_CFLG</span><span class="w"> </span><span class="n">cflg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">flgatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_WMUL</span><span class="p">,</span><span class="w">  </span><span class="c1">// 複数タスクが待てる</span>
<span class="w">    </span><span class="n">iflgptn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c1">// 初期フラグ値（全ビットOFF）</span>
<span class="p">};</span>
<span class="n">cre_flg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">cflg</span><span class="p">);</span>

<span class="c1">// 待つタスク</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskA</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">){</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">flgptn</span><span class="p">;</span>
<span class="w">    </span><span class="n">wai_flg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="mh">0x01</span><span class="p">,</span><span class="c1">//一番後ろビットの変化を待つ</span>
<span class="w">            </span><span class="n">TWF_ORW</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">flgptn</span><span class="p">);</span><span class="c1">// 実際に立っていたビットが返る</span>
<span class="w">    </span><span class="c1">// ビット1が立った → 通信完了 → 処理継続</span>
<span class="p">}</span>

<span class="c1">// 通知タスク</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">comm_task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 通信処理...</span>
<span class="w">    </span><span class="n">set_flg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">);</span><span class="w">  </span><span class="c1">// ビット1をセット（通信完了通知）</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_7">データキュー</h3>
<p>1ワードのメッセージを受け渡すことにより、同期と通信を行うためのオブジェクトである。</p>
<p><strong>データキュー生成情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cdtq</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">dtqatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// データキュー属性</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">dtqcnt</span><span class="p">;</span><span class="w">　</span><span class="c1">// データキュー領域の容量</span>
<span class="w">    </span><span class="n">VP</span><span class="w"> </span><span class="n">dtq</span><span class="p">;</span><span class="w">　</span><span class="c1">// データキュー領域の先頭番地</span>
<span class="p">}</span><span class="w">　</span><span class="n">T_CDTQ</span><span class="p">;</span>
</code></pre></div>
<strong>データーキュー状態情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_rdtq</span><span class="p">{</span>
<span class="w">    </span><span class="n">ID</span><span class="w"> </span><span class="n">stskid</span><span class="p">;</span><span class="w"> </span><span class="c1">// データキューの送信待ち行列の先頭のタスクのID番号</span>
<span class="w">    </span><span class="n">ID</span><span class="w"> </span><span class="n">rtskid</span><span class="p">;</span><span class="w"> </span><span class="c1">// データキューの受信待ち行列の先頭のタスクのID番号 </span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">sdtqcnt</span><span class="p">;</span><span class="w">　</span><span class="c1">// データキューに入っているデータの数</span>
<span class="p">}</span><span class="w"> </span><span class="n">T_RDTQ</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_dtq</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">dtqid</span><span class="p">,</span><span class="n">T_CDTQ</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cdtq</span><span class="p">);</span>
<span class="c1">// データキューの送信</span>
<span class="n">ER</span><span class="w">　</span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snd_dtq</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">dtqid</span><span class="p">,</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="c1">// データキューの受信</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rcv_dtq</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">dtqid</span><span class="p">,</span><span class="n">VP_INT</span><span class="w"> </span><span class="o">*</span><span class="n">p_data</span><span class="p">);</span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// データキューの生成</span>
<span class="n">T_CDTQ</span><span class="w"> </span><span class="n">cdtq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dtqatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span><span class="w"> </span><span class="c1">// FIFO順（TA_TPRIなら優先度順）</span>
<span class="w">    </span><span class="n">dtqcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="c1">// キューの長さ（8個まで送れる）</span>
<span class="w">    </span><span class="n">dtq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="c1">// NULL なら内部で自動確保</span>
<span class="p">};</span>
<span class="n">cre_dtq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cdtq</span><span class="p">);</span><span class="w">  </span><span class="c1">// ID=1 のデータキューを生成</span>

<span class="c1">// 送信タスク</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskA</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1234</span><span class="p">;</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskA: データ送信中: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">snd_dtq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="n">data</span><span class="p">);</span><span class="w">  </span><span class="c1">// ID=1のデータキューに送信</span>
<span class="p">}</span>

<span class="c1">// 受信タスク</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskB</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">intptr_t</span><span class="w"> </span><span class="n">received</span><span class="p">;</span>
<span class="w">    </span><span class="n">rcv_dtq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">received</span><span class="p">);</span><span class="w">  </span><span class="c1">// ID=1のデータキューから一つデータを受ける</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskB: 受信データ = %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">received</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_8">メールボックス</h3>
<p>共有メモリ上に置かれたメッセージを受け渡しすることにより、同期と通信を行うためのオブジェクトである。</p>
<p><strong>メールボックス情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="c1">//生成情報</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cmbx</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">mbxatr</span><span class="p">;</span><span class="w"> </span><span class="c1">//　メールボックス属性</span>
<span class="w">    </span><span class="n">PRI</span><span class="w"> </span><span class="n">maxmpri</span><span class="p">;</span><span class="w">　</span><span class="c1">// 送信されるメッセージの優先度の最大値</span>
<span class="w">    </span><span class="n">VP</span><span class="w"> </span><span class="n">mprihd</span><span class="p">;</span><span class="w">　</span><span class="c1">// 優先度別のメッセージキューヘッダ領域の先頭番地</span>
<span class="p">}</span><span class="n">T_CMBX</span><span class="p">;</span>
<span class="c1">// 状態情報</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_rmbx</span><span class="p">{</span>
<span class="w">    </span><span class="n">ID</span><span class="w"> </span><span class="n">wtskid</span><span class="p">;</span><span class="w"> </span><span class="c1">// メールボックスの待ち行列の先頭のタスクのID</span>
<span class="w">    </span><span class="n">T_MSG</span><span class="o">*</span><span class="w"> </span><span class="n">pk_msg</span><span class="p">;</span><span class="w"> </span><span class="c1">// メッセージキューの先頭のメッセージパケットの先頭番地</span>
<span class="p">}</span><span class="n">T_RMBX</span><span class="p">;</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_mbx</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mbxid</span><span class="p">,</span><span class="n">T_CMBX</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cmbx</span><span class="p">);</span><span class="w"> </span><span class="c1">//メールボックスの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snd_mbx</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mbxid</span><span class="p">,</span><span class="n">T_MSG</span><span class="w"> </span><span class="o">*</span><span class="n">pk_msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// メールボックスの送信</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ecrd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rcv_mbx</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mbxid</span><span class="p">,</span><span class="n">T_MSG</span><span class="w"> </span><span class="o">**</span><span class="n">ppk_msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// メールボックスからの受信</span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// メールボックスを作る</span>
<span class="n">T_CMBX</span><span class="w"> </span><span class="n">cmbx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mbxatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span><span class="w"> </span><span class="c1">// FIFO順</span>
<span class="w">    </span><span class="n">maxmpri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">// 優先度並びを使わない場合は 0</span>
<span class="p">};</span>
<span class="n">cre_mbx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">cmbx</span><span class="p">);</span><span class="w"> </span><span class="c1">// ID=1 のメールボックス生成</span>

<span class="c1">// メッセージ構造体の定義</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">T_MSG</span><span class="w"> </span><span class="n">msg_header</span><span class="p">;</span><span class="w">  </span><span class="c1">// メールボックス用ヘッダ（必須）</span>
<span class="w">    　　　　　　　　　　</span><span class="c1">// 優先度を使いたいならT_MSG_PRIを書く</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="c1">// 実際に送りたいデータ</span>
<span class="p">}</span><span class="n">MY_MSG</span><span class="p">;</span>

<span class="c1">// メッセージの送信</span>
<span class="n">MY_MSG</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="w"> </span><span class="p">};</span>
<span class="n">snd_mbx</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">T_MSG</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span><span class="w">  </span><span class="c1">// メッセージ構造体を送信</span>

<span class="c1">// メッセージの受信</span>
<span class="n">T_MSG</span><span class="o">*</span><span class="w"> </span><span class="n">p_msg</span><span class="p">;</span>
<span class="n">rcv_mbx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">p_msg</span><span class="p">);</span>
<span class="n">MY_MSG</span><span class="o">*</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MY_MSG</span><span class="o">*</span><span class="p">)</span><span class="n">p_msg</span><span class="p">;</span><span class="w"> </span><span class="c1">// キャストして中身を読む</span>

<span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;受信データ = %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">my</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="_9">拡張同期・通信機能</h2>
<p>拡張同期・通信機能はタスクとは独立したオブジェクトにより、タスク間の高度な同期・通信を行うための機能である。</p>
<h3 id="_10">ミューテックス</h3>
<p><strong>優先度逆転</strong>:低優先度のタスクがリソース（ミューテックス）を保持していて,ただ動いてるだけ中優先度のタスク実行しているから、低優先度のタスク実行できなくて、リソースをリリースできない。リソースを待っている高優先度タスクはずっと待ってしまう。これを防ぐために、二つの解決方法がある。</p>
<ul>
<li>
<p><strong>優先度継承プロトコル</strong>：　リソースを持っている低優先度タスクの優先度を、一時的に「待っている中で一番高いタスク」と同じに引き上げる。</p>
</li>
<li>
<p><strong>優先度上限プロトコル</strong>：リソースごとに「上限優先度（最大優先度）」を決めておき、それ以上のタスクしか使えないようにする。低優先度のタスク資源を使えない、中優先度のタスクは高優先度のタスクに影響を与えられない。</p>
</li>
</ul>
<p><strong>ミューテックス生成情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cmtx</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">mtxatr</span><span class="p">;</span><span class="w"> </span><span class="c1">//ミューテックス属性</span>
<span class="w">    </span><span class="n">PRI</span><span class="w"> </span><span class="n">ceilpri</span><span class="p">;</span><span class="w">　</span><span class="c1">// ミューテックスの上限優先度</span>
<span class="p">}</span><span class="n">T_CMTX</span><span class="p">;</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_mtx</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mtxid</span><span class="p">,</span><span class="w"> </span><span class="n">T_CMTX</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cmtx</span><span class="p">);</span><span class="w"> </span><span class="c1">// ミューテックスの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc_mtx</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mtxid</span><span class="p">);</span><span class="w"> </span><span class="c1">//ミューテックスのロック</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unl_mtx</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mtxid</span><span class="p">);</span><span class="w"> </span><span class="c1">//ミューテックスの解除</span>
</code></pre></div></p>
<p><strong>具体的な例</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// 優先度継承プロトコル</span>
<span class="n">T_CMTX</span><span class="w"> </span><span class="n">cmtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mtxatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_INHERIT</span><span class="p">,</span><span class="c1">//優先度継承プロトコルを指定</span>
<span class="p">};</span>
<span class="c1">// 優先度上限プロトコル</span>
<span class="cm">/*</span>
<span class="cm">T_CMTX cmtx = {</span>
<span class="cm">    .mtxatr = TA_CEILING,  // 優先度上限プロトコル</span>
<span class="cm">    .ceilpri = 5           // 優先度上限（5に一時的に引き上げ）</span>
<span class="cm">};</span>
<span class="cm">*/</span>
<span class="n">cre_mtx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cmtx</span><span class="p">);</span><span class="w">  </span><span class="c1">// ミューテックスID = 1</span>

<span class="c1">// TASK A</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskA</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">loc_mtx</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// ミューテックス取得</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskA: 処理中…&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">dly_tsk</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w">  </span><span class="c1">// 長時間処理</span>
<span class="w">    </span><span class="n">unl_mtx</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">     </span><span class="c1">// ミューテックス解放</span>
<span class="p">}</span>
<span class="c1">// TASK B</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskB</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskB: 割り込み処理中&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">dly_tsk</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// TASK C </span>
<span class="kt">void</span><span class="w"> </span><span class="nf">taskC</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dly_tsk</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// 少し遅れて起動</span>
<span class="w">    </span><span class="n">loc_mtx</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">     </span><span class="c1">// TaskAがロック中ならここで待機</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TaskC: ミューテックス取得成功！&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">unl_mtx</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_11">メッセージバッファ</h3>
<p>可変長のメッセージを受け渡しすることにより、同期と通信を行うためのオブジェクトである。</p>
<p><strong>生成情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cmbf</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">mbfatr</span><span class="p">;</span><span class="w"> </span><span class="cm">/*メッセージバッファ属性*/</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">maxmsz</span><span class="p">;</span><span class="w">　</span><span class="c1">//　1メッセージの最大サイズ（バイト数）</span>
<span class="w">    </span><span class="n">SIZE</span><span class="w"> </span><span class="n">mbfsz</span><span class="p">;</span><span class="w">　</span><span class="c1">// メッセージバッファ領域のサイズ（バイト数）</span>
<span class="w">    </span><span class="n">VP</span><span class="w"> </span><span class="n">mbf</span><span class="p">;</span><span class="w"> </span><span class="c1">// メッセージバッファ領域の先頭番地</span>
<span class="p">}</span><span class="w">　</span><span class="n">T_CMBF</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// メッセージバッファの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_mbf</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mbfid</span><span class="p">,</span><span class="n">T_CMBF</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cmbf</span><span class="p">);</span>
<span class="c1">// メッセージバッファの送信</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snd_mbf</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mbfid</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="n">UINT</span><span class="w"> </span><span class="n">msgsz</span><span class="p">);</span>
<span class="c1">// メッセージバッファの受信</span>
<span class="n">ER_UINT</span><span class="w"> </span><span class="n">msgsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rcv_mbf</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mbfid</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// バッファの生成</span>
<span class="k">static</span><span class="w"> </span><span class="n">UB</span><span class="w"> </span><span class="n">mbf_buffer</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span><span class="w">  </span><span class="c1">// バッファ領域（UB＝unsigned char）</span>
<span class="n">T_CMBF</span><span class="w"> </span><span class="n">cmbf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mbfatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span><span class="w">    </span><span class="c1">// FIFO順で処理</span>
<span class="w">    </span><span class="n">maxmsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w">     </span><span class="c1">// 1メッセージ最大サイズ</span>
<span class="w">    </span><span class="n">mbfsz</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w">    </span><span class="c1">// 総バッファサイズ</span>
<span class="w">    </span><span class="n">mbf</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">VP</span><span class="p">)</span><span class="n">mbf_buffer</span><span class="w">  </span><span class="c1">// 自前のバッファ</span>
<span class="p">};</span>

<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_mbf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cmbf</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">E_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;メッセージバッファ作成失敗: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ercd</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// メッセージ送信</span>
<span class="kt">char</span><span class="w"> </span><span class="n">msg</span><span class="p">[]</span><span class="o">=</span><span class="s">&quot;こんにちは、μITRON！&quot;</span><span class="p">;</span>
<span class="n">snd_mbf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// +1 はNULL終端のため</span>

<span class="c1">// メッセージ受信</span>
<span class="kt">char</span><span class="w"> </span><span class="n">recv_buf</span><span class="p">[</span><span class="n">MAX_MSG</span><span class="p">];</span>
<span class="n">rcv_mbf</span><span class="p">(</span><span class="n">MBF_ID</span><span class="p">,</span><span class="n">recv_buf</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="_12">ランデブ</h3>
<p>タスク間で同期通信を行うための機能で、双方のタスクが待ち合わせるためのオブジェクトを、ランデブポートする。</p>
<p><strong>生成情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cpor</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">poratr</span><span class="p">;</span><span class="w"> </span><span class="c1">// ランデブポート属性</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">maxcmsz</span><span class="p">;</span><span class="w">　</span><span class="c1">// 呼出しメッセージの最大サイズ（バイト数）</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">maxrmsz</span><span class="p">;</span><span class="w">　</span><span class="c1">// 返答メッセージの最大サイズ（バイト数）</span>
<span class="p">}</span><span class="n">T_CPOR</span><span class="p">;</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w">　</span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_por</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">porid</span><span class="p">,</span><span class="n">T_CPOR</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cpor</span><span class="p">);</span>
<span class="c1">// ランデブの呼出し</span>
<span class="n">ER_UINT</span><span class="w"> </span><span class="n">rmsgsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cal_por</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">porid</span><span class="p">,</span><span class="n">RDVPTN</span><span class="w"> </span><span class="n">calptn</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="n">UINT</span><span class="w"> </span><span class="n">cmsgsz</span><span class="p">);</span>
<span class="c1">// ランデブの受付</span>
<span class="n">ER_UINT</span><span class="w"> </span><span class="n">cmsgsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acp_por</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">porid</span><span class="p">,</span><span class="n">RDVPTN</span><span class="w"> </span><span class="n">acpptn</span><span class="p">,</span><span class="n">RDVNO</span><span class="w"> </span><span class="o">*</span><span class="n">p_rdvno</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="c1">// ランデブの回送</span>
<span class="n">ER</span><span class="w">　</span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fwd_por</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">porid</span><span class="p">,</span><span class="n">RDVPTN</span><span class="w"> </span><span class="n">calptn</span><span class="p">,</span><span class="n">RDVNO</span><span class="w"> </span><span class="n">rdvno</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="n">UINT</span><span class="w"> </span><span class="n">cmsgsz</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// ランデブポートの作成</span>
<span class="n">T_CPOR</span><span class="w"> </span><span class="n">cpor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">poratr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span>
<span class="w">    </span><span class="n">maxcmsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span>
<span class="w">    </span><span class="n">maxrmsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span>
<span class="p">};</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_por</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cpor</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">E_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ポート作成失敗: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ercd</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// クライアント側のタスク</span>
<span class="kt">void</span><span class="w"> </span><span class="n">client_task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span><span class="w">  </span><span class="c1">// 呼び出しメッセージと返答を共有</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 呼び出しメッセージ</span>

<span class="w">    </span><span class="c1">// ランデブ呼び出し → サーバからの返答も受信</span>
<span class="w">    </span><span class="n">ER_UINT</span><span class="w"> </span><span class="n">recv_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cal_por</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0はRDVPTN番号　サーバ側と一致</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">recv_len</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ランデブ呼び出し失敗: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">recv_len</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;返答受信: %s（%d バイト）&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">recv_len</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="c1">// サーバ側のタスク</span>
<span class="kt">void</span><span class="w"> </span><span class="n">server_task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">recv_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">response</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OK&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">RDVNO</span><span class="w"> </span><span class="n">rdvno</span><span class="p">;</span><span class="c1">// リターンパラメータ</span>

<span class="w">    </span><span class="c1">// クライアントからの呼び出しを受け付ける</span>
<span class="w">    </span><span class="n">ER_UINT</span><span class="w"> </span><span class="n">msgsz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acp_por</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rdvno</span><span class="p">,</span><span class="w"> </span><span class="n">recv_buf</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msgsz</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;acp_por失敗: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msgsz</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;受信メッセージ: %s（サイズ: %d）&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">recv_buf</span><span class="p">,</span><span class="w"> </span><span class="n">msgsz</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 受け取ったランデブ番号を使って返答を返す</span>
<span class="w">        </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fwd_por</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">rdvno</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">E_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;返答送信失敗: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ercd</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="_13">メモリプール管理機能</h2>
<h3 id="_14">固定長メモリプール</h3>
<p>固定されたサイズのメモリブロックを動的に管理するためのオブジェクトである。</p>
<p><strong>生成情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cmpf</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">mpfatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 固定長メモリプール属性</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">blkcnt</span><span class="p">;</span><span class="c1">// 獲得できるメモリブロック数（個数）</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">blksz</span><span class="p">;</span><span class="w">　</span><span class="c1">// メモリブロックのサイズ（バイト数）</span>
<span class="w">    </span><span class="n">VP</span><span class="w"> </span><span class="n">mpf</span><span class="p">;</span><span class="w">　</span><span class="c1">// 固定長メモリプール領域の先頭番地</span>
<span class="p">}</span><span class="w"> </span><span class="n">T_CMPF</span><span class="p">;</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// 固定長メモリプールの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_mpf</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mpfid</span><span class="p">,</span><span class="n">T_CMPF</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cmpf</span><span class="p">);</span>
<span class="c1">// 固定長メモリプールの獲得</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_mpf</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mpfid</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="o">*</span><span class="n">p_blk</span><span class="p">);</span>
<span class="c1">// 固定長メモリブロックの返却</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rel_mpf</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mpfid</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">blk</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="cp">#define MPF_ID  1   </span><span class="c1">// メモリプールID</span>
<span class="cp">#define BLK_SIZE  64</span>
<span class="cp">#define BLK_NUM   10</span>
<span class="c1">// メモリプール</span>
<span class="n">T_CMPF</span><span class="w"> </span><span class="n">cmpf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mpfatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span><span class="w">     </span><span class="c1">// FIFO属性（または TA_TPRI）</span>
<span class="w">    </span><span class="n">mpfcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLK_NUM</span><span class="p">,</span><span class="w">      </span><span class="c1">// ブロック数</span>
<span class="w">    </span><span class="n">blksz</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">BLK_SIZE</span><span class="p">,</span><span class="w">     </span><span class="c1">// ブロックサイズ（バイト）</span>
<span class="w">    </span><span class="n">mpf</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w">          </span><span class="c1">// NULLなら自動で領域確保</span>
<span class="p">};</span>
<span class="n">cre_mpf</span><span class="p">(</span><span class="n">MPF_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cmpf</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">user_task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">){</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>

<span class="w">    </span><span class="c1">//メモリ獲得</span>
<span class="w">    </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_mpf</span><span class="p">(</span><span class="n">MPF_ID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E_OK</span><span class="p">){</span>
<span class="w">        </span><span class="c1">// 使用</span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;Hello memoryPool&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">//メモリ返却</span>
<span class="w">        </span><span class="n">rel_mpf</span><span class="p">(</span><span class="n">MPF_ID</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_15">可変長メモリプール</h3>
<p>任意サイズのメモリブロックを動的に管理するためのオブジェクトである。</p>
<p><strong>生成情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cmpl</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">mplatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 可変長メモリプール属性</span>
<span class="w">    </span><span class="n">SIZE</span><span class="w">　</span><span class="n">mplsz</span><span class="p">;</span><span class="w"> </span><span class="c1">// 可変長メモリプール領域のサイズ（バイト数）</span>
<span class="w">    </span><span class="n">VP</span><span class="w">　</span><span class="n">mpl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 可変長メモリプール領域の先頭番地</span>
<span class="p">}</span>
</code></pre></div>
<strong>apiの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_mpl</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mplid</span><span class="p">,</span><span class="n">T_CMPL</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cmpl</span><span class="p">);</span>
<span class="c1">// 可変長メモリブロックの獲得</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_mpl</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mplid</span><span class="p">,</span><span class="n">UINT</span><span class="w"> </span><span class="n">blksz</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="o">*</span><span class="n">p_blk</span><span class="p">);</span>
<span class="c1">// 可変長メモリブロックの返却</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rel_mpl</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">mplid</span><span class="p">,</span><span class="n">VP</span><span class="w"> </span><span class="n">blk</span><span class="p">);</span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// メモリプールの作成</span>
<span class="n">T_CMPL</span><span class="w"> </span><span class="n">cmpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mplatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_TFIFO</span><span class="p">,</span><span class="w">   </span><span class="c1">// FIFOで待機</span>
<span class="w">    </span><span class="n">mplsz</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">MPL_SIZE</span><span class="p">,</span><span class="w">   </span><span class="c1">// プールの全体サイズ（バイト数）</span>
<span class="w">    </span><span class="n">mpl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w">        </span><span class="c1">// NULLなら自動割当</span>
<span class="p">};</span>

<span class="n">cre_mpl</span><span class="p">(</span><span class="n">MPL_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cmpl</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">user_task</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="n">UINT</span><span class="w"> </span><span class="n">req_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">  </span><span class="c1">// 必要なメモリサイズ</span>

<span class="w">    </span><span class="c1">// メモリ獲得 今回はreq_sizeのサイズメモリが欲しい</span>
<span class="w">    </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_mpl</span><span class="p">(</span><span class="n">MPL_ID</span><span class="p">,</span><span class="w"> </span><span class="n">req_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ercd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;メモリ獲得成功: %p&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 使用（例：データ格納）</span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;可変長メモリ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;内容: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// メモリ返却</span>
<span class="w">        </span><span class="n">rel_mpl</span><span class="p">(</span><span class="n">MPL_ID</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;メモリ返却完了&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;メモリ獲得失敗: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ercd</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="_16">割り込み管理機能</h2>
<p>割り込み管理機能は、外部割込みによって起動される割込みハンドラおよび割り込みサービスルーチンを管理するための機能である。</p>
<p><strong>割込みハンドラおよびサービスルーチン定義情報</strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_dinh</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">inhatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 割込みハンドラ属性</span>
<span class="w">    </span><span class="n">FP</span><span class="w">　</span><span class="n">inthdr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 割込みハンドラの起動番地</span>
<span class="p">}</span><span class="n">T_DINH</span><span class="p">;</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cisr</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">isratr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 割り込みサービスルーチン属性</span>
<span class="w">    </span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">;</span><span class="w"> </span><span class="c1">// 割り込みサービスルーチンの拡張情報</span>
<span class="w">    </span><span class="n">INTNO</span><span class="w">　</span><span class="n">intno</span><span class="p">;</span><span class="w"> </span><span class="c1">// 割り込みサービスルーチンを付加する割り込み番号</span>
<span class="w">    </span><span class="n">FP</span><span class="w"> </span><span class="n">isr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 割り込みサービスルーチンの起動番地</span>
<span class="p">}</span><span class="n">T_CISR</span><span class="p">;</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">def_inh</span><span class="p">(</span><span class="n">INHNO</span><span class="w"> </span><span class="n">inhno</span><span class="p">,</span><span class="n">T_DINH</span><span class="w"> </span><span class="o">*</span><span class="n">pk_dinh</span><span class="p">);</span><span class="c1">// 割込みハンドラの定義</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ecrd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_isr</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">isrid</span><span class="p">,</span><span class="n">T_CISR</span><span class="w"> </span><span class="o">*</span><span class="n">pk_cisr</span><span class="p">);</span><span class="w"> </span><span class="c1">// 割込みサービスルーチンの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ena_int</span><span class="p">(</span><span class="n">INTNO</span><span class="w"> </span><span class="n">intno</span><span class="p">);</span><span class="w"> </span><span class="c1">// 割込みの許可</span>
</code></pre></div></p>
<p><strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="cp">#define IRQ_NUM  5       </span><span class="c1">// 使用する割込み番号</span>

<span class="cm">/* 1. 割込みハンドラ（Inh）：ハードウェア割込み発生直後に実行 */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">my_inh_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// 最小限の処理</span>
<span class="w">    </span><span class="c1">// ......</span>
<span class="p">}</span>
<span class="cm">/*2. 割込みサービスルーチン（ISR）：Inh 後に起動されるユーザ処理 */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">my_isr</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// 「重め」の処理</span>
<span class="w">    </span><span class="c1">// ......</span>
<span class="p">}</span>
<span class="cm">/* 3. 割込みの定義と有効化を行う初期化関数 */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">setup_interrupt</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
<span class="w">    </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// 割込みハンドラの定義</span>
<span class="w">    </span><span class="n">T_DINH</span><span class="w"> </span><span class="n">dinh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">inhatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_ENAINT</span><span class="p">,</span><span class="w"> </span><span class="c1">// 応答許可</span>
<span class="w">        </span><span class="n">inthdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_inh_handler</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">def_inh</span><span class="p">(</span><span class="n">IRQ_NUM</span><span class="p">,</span><span class="o">&amp;</span><span class="n">dinh</span><span class="p">);</span>

<span class="cm">/*4.割込みサービスルーチンの定義 */</span>
<span class="n">T_CISR</span><span class="w"> </span><span class="n">cisr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">isratr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_ACT</span><span class="p">,</span><span class="w"> </span><span class="c1">// 起動属性：自動起動型</span>
<span class="w">    </span><span class="n">exinf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// 拡張情報 (任意設定可)</span>
<span class="w">    </span><span class="n">intno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IRQ_NUM</span><span class="p">,</span><span class="c1">// 対応する割込み番号</span>
<span class="w">    </span><span class="n">isr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_isr</span>
<span class="p">};</span>
<span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_isr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">cisr</span><span class="p">);</span>

<span class="c1">// 割込みの有効化</span>
<span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ena_int</span><span class="p">(</span><span class="n">IRQ_NUM</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="_17">時間管理機能</h2>
<p>時間管理機能は、時間に依存した処理を行うための機能である。システム時刻管理、周期ハンドラ、アラームハンドラ、オーバランハンドラの各機能が含まれる。</p>
<h3 id="_18">システム時刻管理</h3>
<p>システム時刻を操作するための機能である。システム時刻を設定/参照する機能、タイムティックを供給してシステム時刻を更新する機能が含まれる。</p>
<p><strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// システム時刻の設定</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_tim</span><span class="p">(</span><span class="n">SYSTIM</span><span class="w"> </span><span class="o">*</span><span class="n">p_systim</span><span class="p">);</span>
<span class="c1">// システム時刻の参照</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_tim</span><span class="p">(</span><span class="n">SYSTIM</span><span class="w"> </span><span class="o">*</span><span class="n">p_systim</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>使い方の例</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// 今の時刻を獲得する</span>
<span class="n">SYSTEM</span><span class="w"> </span><span class="n">now</span><span class="p">;</span>
<span class="n">ER</span><span class="w">　</span><span class="n">ercd</span><span class="p">;</span>
<span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_utim</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">);</span>

<span class="c1">// 時刻を設定する</span>
<span class="n">SYSTIM</span><span class="w">   </span><span class="n">init_time</span><span class="p">;</span>
<span class="n">init_time</span><span class="p">.</span><span class="n">ut_year</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">2025</span><span class="p">;</span>
<span class="n">init_time</span><span class="p">.</span><span class="n">ut_mon</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="n">init_time</span><span class="p">.</span><span class="n">ut_day</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">;</span>
<span class="n">init_time</span><span class="p">.</span><span class="n">ut_hour</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="n">init_time</span><span class="p">.</span><span class="n">ut_min</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">init_time</span><span class="p">.</span><span class="n">ut_sec</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_utim</span><span class="p">(</span><span class="o">&amp;</span><span class="n">init_time</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="_19">周期ハンドラ</h3>
<p>周期ハンドラは,一定周期で起動されるタイムイベントハンドラである。</p>
<p><strong>生成情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">cychdr</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">周期ハンドラ本体</span>
<span class="p">}</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_ccyc</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">cycatr</span><span class="p">;</span><span class="w"> </span><span class="c1">//周期ハンドラ属性</span>
<span class="w">    </span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">;</span><span class="w"> </span><span class="c1">// 周期ハンドラの拡張情報</span>
<span class="w">    </span><span class="n">FP</span><span class="w">　</span><span class="n">cychdr</span><span class="p">;</span><span class="w"> </span><span class="c1">// 周期ハンドラの起動番地</span>
<span class="w">    </span><span class="n">RELTIM</span><span class="w">　</span><span class="n">cyctim</span><span class="p">;</span><span class="w"> </span><span class="c1">// 周期ハンドラの起動周期</span>
<span class="w">    </span><span class="n">RELTIM</span><span class="w">　</span><span class="n">cycphs</span><span class="p">;</span><span class="w"> </span><span class="c1">// 周期ハンドラの起動位相</span>
<span class="p">}</span><span class="n">T_CCYC</span>
</code></pre></div>
<strong>APIの説明</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// 周期ハンドラの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_cyc</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">cycid</span><span class="p">,</span><span class="n">T_CCYC</span><span class="w"> </span><span class="o">*</span><span class="n">pk_ccyc</span><span class="p">);</span>
<span class="c1">// 周期ハンドラの動作開始</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sta_cyc</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">cycid</span><span class="p">);</span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">led_cyc_handler</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// 周期ハンドラ関数本体</span>
<span class="w">    </span><span class="c1">// ......</span>
<span class="p">}</span>

<span class="c1">// 周期ハンドラ初期化処理</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">setup_create</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
<span class="w">    </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="p">;</span>
<span class="w">    </span><span class="n">T_CCYC</span><span class="w"> </span><span class="n">ccyc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cycatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_HLNG</span><span class="p">,</span><span class="c1">//高級言語用</span>
<span class="w">        </span><span class="n">exinf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// 拡張情報（不要なら0）</span>
<span class="w">        </span><span class="n">cyctim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="c1">// 周期：1000ミリ秒</span>
<span class="w">        </span><span class="n">cycphs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// 最初の起動遅延：0ミリ秒</span>
<span class="w">        </span><span class="n">cychdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">led_cyc_handler</span><span class="w"> </span><span class="c1">// ハンドラ関数</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_cyc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ccyc</span><span class="p">);</span>

<span class="w">    </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sta_cyc</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div></p>
<h3 id="_20">アラームハンドラ</h3>
<p>アラームハンドラは、指定した時刻に起動されるタイムイベントハンドラである。</p>
<p><strong>生成情報構造体</strong>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">almhdr</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">){</span>
<span class="w">    </span><span class="n">アラームハンドラ本体</span>
<span class="p">}</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_calm</span><span class="p">{</span>
<span class="w">    </span><span class="n">ATR</span><span class="w"> </span><span class="n">almatr</span><span class="p">;</span><span class="w"> </span><span class="c1">// アラームハンドラ属性</span>
<span class="w">    </span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">;</span><span class="w">　</span><span class="c1">// アラームハンドラの拡張情報</span>
<span class="w">    </span><span class="n">FP</span><span class="w"> </span><span class="n">almhdr</span><span class="p">;</span><span class="w">　</span><span class="c1">// アラームハンドラの起動番地</span>
<span class="p">}</span><span class="n">T_CALM</span><span class="p">;</span>
</code></pre></div>
<strong>apiの説明</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// アラームハンドラの生成</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_alm</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">almid</span><span class="p">,</span><span class="n">T_CALM</span><span class="w"> </span><span class="o">*</span><span class="n">pk_calm</span><span class="p">);</span>
<span class="c1">// アラームハンドラの動作開始</span>
<span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sta_alm</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">almid</span><span class="p">,</span><span class="n">RELTIM</span><span class="w"> </span><span class="n">almtim</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
<strong>具体的な例</strong>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">alarm_handler</span><span class="p">(</span><span class="n">VP_INT</span><span class="w"> </span><span class="n">exinf</span><span class="p">){</span>
<span class="w">    </span><span class="cm">/* アラームハンドラ本体：指定時間後に呼ばれる */</span>
<span class="w">    </span><span class="c1">//......</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup_alarm</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
<span class="w">    </span><span class="n">ER</span><span class="w"> </span><span class="n">ercd</span><span class="p">;</span>
<span class="w">    </span><span class="n">T_CALM</span><span class="w"> </span><span class="n">calm</span><span class="o">=</span><span class="p">{</span>
<span class="w">        </span><span class="n">almatr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TA_HLNG</span><span class="p">,</span>
<span class="w">        </span><span class="n">exinf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="n">almhdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alarm_handler</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cre_alm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">calm</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//2000 ms後　アラームの開始</span>
<span class="w">    </span><span class="n">ercd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sta_alm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="_21">型の説明</h2>
<ul>
<li><code>VP</code>:データタイプが定まらないものへのポインタ</li>
<li><code>VP_INT</code>: データタイプが定まらないものへのポインタまたはプロセッサに自然なサイズの符号付き整数</li>
<li><code>TA_WMUL</code>: イベントフラグを複数のタスクが待つことを許す</li>
<li><code>RDVNO</code>: ランデブ番号</li>
<li><code>RDVPTN</code>: ランデブ条件のビットパターン（符号なし整数）</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>